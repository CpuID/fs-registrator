sudo: required
dist: trusty

language: go
go:
  - 1.6.3

services:
  - docker

before_install:
  # Upgrade Docker (Travis version is 1.8.x)
  - sudo sh -c 'echo "deb https://apt.dockerproject.org/repo ubuntu-precise main" > /etc/apt/sources.list.d/docker.list'
  - sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D
  - sudo apt-get update
  - sudo apt-key update
  - sudo apt-get -qqy -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold" install docker-engine=1.11.1-0~trusty
  - docker version
  # Sipsak for simulating SIP Register/Deregister
  - sudo apt-get -qqy -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold" install sipsak
  - sudo sh -c "echo '127.0.0.1   sip.testserver.tld' >> /etc/hosts"
  # Stuff for Golang
  - go get github.com/mattn/goveralls
  - go get golang.org/x/tools/cmd/cover

script:
  - go test -covermode=count -coverprofile=profile.cov -v ./...
  - $HOME/gopath/bin/goveralls -coverprofile=profile.cov -service=travis-ci
  # - docker ps
  # - docker logs fsregistrator_freeswitch_1
